Bootstrap: docker
From: alpine:3.8

%labels
MAINTAINER Laurent Modolo

%post
mkdir -p /sps /pbs /scratch
SAMTOOLS_VERSION=1.7
HISAT2_VERSION=2.1.0
PACKAGES="git \
          make \
          gcc \
          musl-dev \
          zlib-dev \
          ncurses-dev \
          bzip2-dev \
          xz-dev \
          bash \
          curl \
          zip \
          g++ \
          perl \
          python"
apk update && \
apk add ${PACKAGES}

git clone https://github.com/samtools/htslib.git && \
cd htslib && \
git checkout ${SAMTOOLS_VERSION}  && \
cd .. && \
git clone https://github.com/samtools/samtools.git && \
cd samtools && \
git checkout ${SAMTOOLS_VERSION} && \
make && \
cp samtools /usr/bin/

curl -k -L http://ccb.jhu.edu/software/hisat2/dl/hisat2-${HISAT2_VERSION}-source.zip -o hisat2_linux-v${HISAT2_VERSION}.zip && \
unzip hisat2_linux-v${HISAT2_VERSION}.zip && \
cd hisat2-${HISAT2_VERSION} && \
make && \
cp hisat2 /usr/bin && \
cp hisat2-* /usr/bin && \
rm -Rf hisat2-${HISAT2_VERSION}

%environment
export SAMTOOLS_VERSION=1.7
export HISAT2_VERSION=2.1.0

%runscript
exec /bin/bash "$@"
